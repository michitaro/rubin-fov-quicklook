{{- if .Values.use_vault }}
apiVersion: ricoberger.de/v1alpha1
kind: VaultSecret
metadata:
  name: fov-quicklook-secret
spec:
  path: "{{ .Values.global.vaultSecretsPathPrefix }}/fov-quicklook"
  type: Opaque
  keys:
    - s3_repository_aceess_key
    - s3_repository_secret_key
    - s3_tile_access_key
    - s3_tile_secret_key
{{- else }}
apiVersion: v1
kind: Secret
metadata:
  name: fov-quicklook-secret
type: Opaque
data:
  s3_repository_aceess_key: quicklook
  s3_repository_secret_key: password
  s3_tile_access_key: quicklook
  s3_tile_secret_key: password
{{- end }}
---
# https://itnext.io/manage-auto-generated-secrets-in-your-helm-charts-5aee48ba6918
{{- $secretObj := (lookup "v1" "Secret" .Release.Namespace "quicklook-db") | default dict }}
{{- $secretData := (get $secretObj "data") | default dict }}
{{- $password := (get $secretData "password") | default (randAlphaNum 48 | b64enc) }}
apiVersion: v1
kind: Secret
metadata:
  name: quicklook-db
  annotations:
    "helm.sh/resource-policy": "keep"
type: Opaque
data:
  password: {{ $password | quote }}
